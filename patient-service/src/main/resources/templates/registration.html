<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>智能挂号-预约</title>
    <link rel="stylesheet" href="/bootstrap-4.6.2-dist/css/bootstrap.min.css">
    <script src="/jquery-3.7.1.min.js"></script>
    <script src="/bootstrap-4.6.2-dist/js/bootstrap.min.js"></script>
    <style>
        .doctor-photo {
            max-width: 120px;
            max-height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<div class="container mt-5" id="doctors">
    <h2 class="mb-4 text-center">选择医生</h2>
    <!-- 日程选择 -->
    <!-- <div class="text-center mb-4 btn-time-slot" id="time-slot-group"> -->
    <!--     <span th:each="slot, slotStat: ${timeSlots}"> -->
    <!--         <input type="radio" th:id="'slot' + ${slotStat.index}" name="timeSlot" th:value="${slot.datetime}"> -->
    <!--         <label th:for="'slot' + ${slotStat.index}" th:text="${slot.label}"></label> -->
    <!--     </span> -->
    <!-- </div> -->
    <ul class="nav nav-pills justify-content-center mb-4" id="timeNav">
        <!-- <li class="nav-item"> -->
        <!--     <a class="nav-link" th:href="@{/registration/${clinicId}}"> -->
        <!--         全部 -->
        <!--     </a> -->
        <!-- </li> -->
        <li class="nav-item" th:each="slot: ${timeSlots}">
            <a class="nav-link" th:href="@{/registration/{clinicId}/{date}/{time}(clinicId=${clinicId}, date=${slot.date}, time=${slot.time})}"
               th:attr="data-date=${slot.date}, data-time=${slot.time}"
               th:text="${slot.label}">
                日程
            </a>
        </li>
    </ul>

    <!-- 医生列表 -->
    <div class="col-md-12 mb-4">
        <table class="table table-bordered table-striped">
            <thead class="thead-dark">
            <tr>
                <th>照片</th>
                <th>姓名</th>
                <th>职称</th>
                <th>简介</th>
                <th>预约</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="schedule: ${schedule}">
                <td>
                    <img th:src="'data:image/jpeg;base64,'+${schedule.doctor.photoBase64}" class="doctor-photo" alt="医生照片"/>
                </td>
                <td th:text="${schedule.doctor.name}">医生姓名</td>
                <td th:text="${schedule.doctor.role}">医生职称</td>
                <td th:text="${schedule.doctor.desc}">医生简介</td>
                <td>
                    <a th:if="${schedule.count} < 5" class="btn btn-sm btn-outline-primary btn-register" th:attr="data-doctor-id=${schedule.doctor.id}">
                        挂号
                    </a>
                    <a th:if="${schedule.count} >= 5" class="btn btn-sm btn-outline-secondary btn-disabled" disabled>
                        已满
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script th:inline="javascript">
    const date = [[${date}]];
    const time = [[${time}]];
    // 导航栏自动高亮
    $(document).ready(function () {
        const currentPath = window.location.pathname;
        $('.nav-link').each(function () {
            const link = $(this);
            const href = link.attr('href');

            if (currentPath === href) {
                link.addClass('active');
            } else {
                link.removeClass('active');
            }
        });
    });
    $(document).ready(function () {
        $('.btn-register').on('click', function () {
            const doctorId = $(this).data('doctor-id');
            // const timeSlot = $('input[name="timeSlot"]:checked').val();
            // const [date, time] = timeSlot.split(/-(?=[AP]M)/);
            // const selectedDate = $('#timeNav').data('date');
            // const selectedTime = $('#timeNav').data('time')

            // if (!timeSlot) {
            //     alert("请先选择预约的日期和时间段！");
            //     return;
            // }

            // 发送 AJAX 请求
            $.ajax({
                url: '/registerAppointment',  // 请根据实际接口路径调整
                method: 'POST',
                data: {
                    doctorId: doctorId,
                    date: date,
                    time: time
                },
                success: function (response) {
                    alert("挂号成功！");
                },
                error: function (xhr) {
                    let msg = "挂号失败，请稍后重试";
                    if (xhr.responseText) {
                        msg = xhr.responseText;
                    }
                    alert(msg);
                }
            });
        });
    });
</script>

</body>
</html>